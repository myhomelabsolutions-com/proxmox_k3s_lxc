---
apiVersion: v1
kind: Namespace
metadata:
  name: argocd

---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

namespace: argocd

patches:
  - target:
      kind: Deployment
      name: argocd-server
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/command
        value:
          - argocd-server
          - --insecure
          - --staticassets
          - /shared/app

---
apiVersion: v1
kind: Service
metadata:
  name: argocd-server-nodeport
  namespace: argocd
spec:
  type: NodePort
  ports:
    - port: 84430
      targetPort: 8080
      nodePort: 30080
  selector:
    app.kubernetes.io/name: argocd-server